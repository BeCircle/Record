# 相关性搜索

## 倒排索引

倒排索引的组成：

	词典： 词，和每个词唯一的序号之间的映射；
	倒排表： 词的序号到所有包含它的文档的序号之间的映射;
	文档列表： 文档内容，每个内容有一个唯一的序号;
	除了以上核心部分，Lucene 在索引中添加了更多的数据结构和元数据：文档频率、词频、词位置、词偏移量、负载数据、存储字段、文档值。

## 对内容进行索引
提取

充实

	清理数据
	强化已有数据
	合并外部数据

分析

	字符过滤
	分词处理： 利用标点符号和空格进行分词
	token过滤： 小写 token 过滤、禁用词 token 过滤、所有格token过滤

索引

	索引： 利用提取到的 token 对倒排索引加以更新，以使相应字段可以被搜索到的过程。一个字段只有经过了索引才可以被搜索到。
	存储： 保留最初未经改动的文档内容，将其存入一种称为存储字段的数据结构，以便后面将其取出并放入搜索结果中呈献给用户。只有数据被存储了才能返回呈献给用户。
	只有当分析完一定数量的文档或者等待了足够长的时间以后，经过分析的文档才会被提交到索引。

## 文档的搜索和获取

布尔搜索： 

	AND: 两个条件的交集
	OR： 两个条件的并集
	NOT：？？？去掉匹配的

基于Lucene 搜索的布尔查询

	MUST： 文档中必须有，用 “+” 表示
 	MUST_NOT： 匹配条件的文档一定不会包含在搜索结果中，即使满足 MUST 和 SHOULD 子句，用 “-” 表示
	SHOULD： 文档中可以有匹配，匹配的排序在前

位置和短语匹配

	Lucene 提供了计入词位置的短语查询，语句中用引号引起来，例如，“dress shoes”。

	匹配短语，搜索引擎需要两个步骤：
		a. 找到匹配短语中每一个单词的所有文档。
		b. 去掉两个单词不相邻的文档。

	短语查询兼容 Lucene 的布尔查询。
	在 Elasticsearch 和 Solr 词语位置默认情况下被包含于倒排索引。

助力用户浏览： 过滤、切面和聚合

	Lucene 的数据结构支持复杂的、多层次的过滤、分组和聚合， Elasticsearch 也有聚合功能。

排序、结果排名，以及相关性